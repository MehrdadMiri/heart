{% extends "base.html" %}
{% load embed %}
{% block meta_tags %}
  <meta name="description" content="{{ post.body_md|striptags|truncatechars:160 }}">
  <link rel="canonical" href="{{ request.build_absolute_uri }}">
  <meta property="og:title" content="{{ post.title }}">
  <meta property="og:description" content="{{ post.body_md|striptags|truncatechars:160 }}">
  <meta property="og:url" content="{{ request.build_absolute_uri }}">
  <meta property="og:type" content="article">
{% endblock %}
{% block title %}{{ post.title }}{% endblock %}
{% block content %}
  <article class="mx-auto" style="max-width:700px;">
    <h1 class="mb-3">{{ post.title }}</h1>

    <div class="markdown-body">{{ html_body|safe }}</div>
    {% if post.video_url %}
      <figure class="ratio ratio-16x9 rounded mt-4">
        <iframe src="{{ post.video_url|aparat_embed }}" allowfullscreen></iframe>
      </figure>
    {% endif %}
  </article>

  <section class="mt-5" id="comments">
    <h2 class="h4 mb-3">نظرات</h2>
    {% for c in comments %}
      <div class="mb-3 border rounded p-3">
        <strong>{{ c.author.username }}</strong>
        <span class="text-muted small">{{ c.created_at|date:"Y-m-d H:i" }}</span>
        <p class="mb-0">{{ c.body }}</p>
      </div>
    {% empty %}
      <p class="text-muted">هنوز نظری ثبت نشده است.</p>
    {% endfor %}

    {% if user.is_authenticated %}
      <form method="post" class="mt-4">
        {% csrf_token %}
        {{ form.body }}
        <button type="submit" class="btn btn-primary mt-2">ارسال نظر</button>
      </form>
    {% else %}
      <p class="mt-4">برای ثبت نظر لطفا <a href="{% url 'account_login' %}?next={{ request.path }}">وارد شوید</a>.</p>
    {% endif %}
  </section>
{% endblock %}

